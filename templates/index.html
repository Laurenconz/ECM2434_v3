<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <link rel="icon" href="/static/sustainability-bingo-logo.ico"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="theme-color" content="#000000"/>
    <meta name="description" content="Sustainability Bingo App"/>
    <link rel="apple-touch-icon" href="/static/sustainability bingo logo.jpeg"/>
    <link rel="manifest" href="/static/manifest.json"/>
    <title>Sustainability Bingo</title>
    
    <!-- Fix Functions Before React Loads -->
    <script>
        // Define these functions immediately, before any other scripts run
        console.log('Applying fixes before scripts load...');
        window.e = function() { return null; };
        window.n = function() { return null; };
        window.showNotification = function() {};
        window.showProgressUpdate = function() {};
        window.showTaskCompletion = function() {};
        window.showPatternCompletion = function() {};
        window.showPopup = function(options) {
            if (options && options.onConfirm) setTimeout(options.onConfirm, 100);
        };
    </script>
    
    <!-- Now load the main app script -->
    <script defer="defer" src="/static/js/main.b2233ee6.js"></script>
    <link href="/static/css/main.ebfb8bca.css" rel="stylesheet">
</head>
<body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    
    <!-- Additional fixes after DOM loads -->
    <script>
        window.addEventListener('DOMContentLoaded', function() {
            console.log('Applying additional fixes...');
            
            // Fix localhost URL references in fetch calls
            const originalFetch = window.fetch;
            window.fetch = function(url, options) {
                if (typeof url === 'string' && url.includes('localhost:8000')) {
                    url = url.replace('localhost:8000', '');
                    console.log('Fixed URL:', url);
                }
                return originalFetch(url, options);
            };
            
            // Fix axios if it exists
            if (window.axios) {
                const originalGet = window.axios.get;
                window.axios.get = function(url, config) {
                    if (url.includes('localhost:8000')) {
                        url = url.replace('localhost:8000', '');
                        console.log('Fixed axios URL:', url);
                    }
                    return originalGet(url, config);
                };
                
                const originalPost = window.axios.post;
                window.axios.post = function(url, data, config) {
                    if (url.includes('localhost:8000')) {
                        url = url.replace('localhost:8000', '');
                        console.log('Fixed axios POST URL:', url);
                    }
                    return originalPost(url, data, config);
                };
            }
            
            // Fix image loading errors
            document.addEventListener('error', function(e) {
                if (e.target.tagName === 'IMG') {
                    console.log('Image load error, using fallback for:', e.target.src);
                    e.target.src = '/static/default.png';
                    e.preventDefault();
                }
            }, true);
            
            console.log('All fixes applied!');
        });
    </script>
    <script>
        // Debug API calls - run this manually after page loads
        document.addEventListener('DOMContentLoaded', function() {
          console.log('Testing direct API access...');
          window.testAPI = function() {
            console.log('Fetching leaderboard with fetch...');
            fetch('/api/leaderboard/')
              .then(r => r.text())
              .then(text => {
                console.log('Raw response:', text);
                try {
                  return JSON.parse(text);
                } catch (e) {
                  console.error('Failed to parse JSON:', e);
                  console.log('Text was:', text);
                  throw e;
                }
              })
              .then(data => {
                console.log('Leaderboard data:', data);
                alert('API test successful!');
              })
              .catch(err => {
                console.error('API test failed:', err);
                alert('API test failed: ' + err.message);
              });
          };
          
          // Create a test button
          const btn = document.createElement('button');
          btn.textContent = 'Test API';
          btn.style.position = 'fixed';
          btn.style.top = '10px';
          btn.style.right = '10px';
          btn.style.zIndex = '9999';
          btn.onclick = window.testAPI;
          document.body.appendChild(btn);
        });
      </script>
</body>
</html>